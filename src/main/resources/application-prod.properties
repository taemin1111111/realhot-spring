# ===== 운영 환경 설정 (wherehotnow.com 최적화) =====

# ===== 데이터베이스 설정 =====
# 운영환경에서는 반드시 환경변수로 설정
spring.datasource.url=${DB_URL:jdbc:mysql://localhost:3306/wherehot_db?serverTimezone=Asia/Seoul&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true&rewriteBatchedStatements=true}
spring.datasource.username=${DB_USERNAME:wherehot_user}
spring.datasource.password=${DB_PASSWORD:S7r!k#9vQp2&bL4xZt^6mNw}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ===== HikariCP 최적화 (대용량 트래픽 - 1만명 동시 접속) =====
spring.datasource.hikari.maximum-pool-size=200
spring.datasource.hikari.minimum-idle=50
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.initialization-fail-timeout=1

# ===== 서버 설정 =====
server.port=8080
server.address=0.0.0.0

# ===== JSP 설정 (WAR 배포용) =====
spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp
server.jsp-servlet.init-parameters.development=false
server.jsp-servlet.init-parameters.compiler-target-vm=17
server.jsp-servlet.init-parameters.compiler-source-vm=17
server.jsp-servlet.init-parameters.reload-interval=0
server.jsp-servlet.init-parameters.check-interval=0

# ===== 서버 최적화 (Tomcat - 1만명 동시 접속) =====
server.tomcat.threads.max=2000
server.tomcat.threads.min-spare=200
server.tomcat.max-connections=50000
server.tomcat.accept-count=5000
server.tomcat.connection-timeout=30000
server.tomcat.keep-alive-timeout=120000
server.tomcat.max-keep-alive-requests=2000

# ===== 압축 최적화 =====
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml
server.compression.min-response-size=512

# ===== 캐시 설정 =====
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=10000,expireAfterWrite=1h
spring.cache.cache-names=users,hotplaces,regions,categories,votes

# ===== Redis 설정 (대용량 세션 관리 - 1만명 동시 접속) =====
# Redis 사용 안함 (운영 환경 - 메모리 캐시 사용)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration

# ===== JWT 설정 =====
# 운영환경에서는 반드시 환경변수로 설정 (보안 강화)
app.jwt.secret=${JWT_SECRET:taeminSecureJwtSecretKey2024SuperLongSecureKeyForProductionEnvironment12345}
app.jwt.expiration=7200
app.jwt.refresh-expiration=604800

# ===== 로깅 최적화 (운영 환경) =====
logging.level.root=WARN
logging.level.com.wherehot.spring=INFO
logging.level.org.springframework.security=WARN
logging.level.org.mybatis=ERROR
logging.level.com.zaxxer.hikari=WARN
logging.file.name=logs/hotplace.log
logging.file.max-size=100MB
logging.file.max-history=30
logging.logback.rollingpolicy.clean-history-on-start=true

# ===== 모니터링 설정 =====
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when_authorized
management.metrics.export.prometheus.enabled=true

# ===== 보안 강화 =====
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=lax
server.servlet.session.cookie.path=/
server.error.include-stacktrace=never
server.error.include-message=never
server.error.include-binding-errors=never

# ===== JSON 최적화 =====
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.write-null-map-values=false
spring.jackson.default-property-inclusion=NON_NULL
spring.jackson.serialization.fail-on-empty-beans=false

# ===== 비동기 처리 최적화 =====
spring.task.execution.pool.core-size=20
spring.task.execution.pool.max-size=200
spring.task.execution.pool.queue-capacity=1000
spring.task.execution.pool.keep-alive=60s
spring.task.execution.thread-name-prefix=async-

# ===== 웹 최적화 =====
spring.web.resources.cache.cachecontrol.max-age=31536000
spring.web.resources.cache.cachecontrol.cache-public=true
spring.web.resources.chain.strategy.content.enabled=true
spring.web.resources.chain.strategy.content.paths=/**
spring.web.resources.chain.strategy.fixed.enabled=true
spring.web.resources.chain.strategy.fixed.paths=/css/**,/js/**,/images/**
spring.web.resources.chain.strategy.fixed.version=v1.0

# ===== OAuth2 설정 (네이버) =====
# 운영환경에서는 반드시 환경변수로 설정
spring.security.oauth2.client.registration.naver.client-id=${OAUTH2_NAVER_CLIENT_ID:Uhipu8CFRcKrmTNw5xie}
spring.security.oauth2.client.registration.naver.client-secret=${OAUTH2_NAVER_CLIENT_SECRET:32CliACoQi}
spring.security.oauth2.client.registration.naver.scope=name,email,profile_image
spring.security.oauth2.client.registration.naver.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.naver.redirect-uri=${OAUTH2_REDIRECT_URI:https://wherehotnow.com/oauth2/code/naver}

spring.security.oauth2.client.provider.naver.authorization-uri=https://nid.naver.com/oauth2.0/authorize
spring.security.oauth2.client.provider.naver.token-uri=https://nid.naver.com/oauth2.0/token
spring.security.oauth2.client.provider.naver.user-info-uri=https://openapi.naver.com/v1/nid/me
spring.security.oauth2.client.provider.naver.user-name-attribute=response

# ===== 파일 업로드 경로 (운영 환경 - WAR 배포용) =====
app.upload.dir=${UPLOAD_DIR:/opt/tomcat/webapps/taeminspring/uploads/hpostsave}
file.upload.notice-path=${UPLOAD_NOTICE_PATH:/opt/tomcat/webapps/taeminspring/uploads/notices}
file.upload.place-path=${UPLOAD_PLACE_PATH:/opt/tomcat/webapps/taeminspring/uploads/places}
file.upload.md-path=${UPLOAD_MD_PATH:/opt/tomcat/webapps/taeminspring/uploads/mdsave}
file.upload.community-path=${UPLOAD_COMMUNITY_PATH:/opt/tomcat/webapps/taeminspring/uploads/community}
file.upload.course-path=${UPLOAD_COURSE_PATH:/opt/tomcat/webapps/taeminspring/uploads/course}

# ===== 파일 업로드 설정 (WAR 배포용) =====
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=100MB
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.location=/tmp
spring.servlet.multipart.resolve-lazily=false

# ===== 애플리케이션 최적화 =====
spring.main.lazy-initialization=false
spring.jmx.enabled=false
spring.output.ansi.enabled=never

# ===== MyBatis 최적화 =====
mybatis.configuration.cache-enabled=true
mybatis.configuration.lazy-loading-enabled=false
mybatis.configuration.multiple-result-sets-enabled=true
mybatis.configuration.use-column-label=true
mybatis.configuration.use-generated-keys=true
mybatis.configuration.auto-mapping-behavior=partial
mybatis.configuration.default-statement-timeout=30
mybatis.configuration.default-fetch-size=100
