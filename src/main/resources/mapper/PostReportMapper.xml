<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wherehot.spring.mapper.PostReportMapper">

    <!-- 결과 매핑 -->
    <resultMap id="PostReportResultMap" type="com.wherehot.spring.entity.PostReport">
        <id property="id" column="id"/>
        <result property="postId" column="post_id"/>
        <result property="userKey" column="user_key"/>
        <result property="reason" column="reason"/>
        <result property="content" column="content"/>
        <result property="reportTime" column="report_time"/>
    </resultMap>

    <!-- 신고 추가 -->
    <insert id="insertReport" parameterType="com.wherehot.spring.entity.PostReport" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO hottalk_report (
            post_id, user_key, reason, content, report_time
        ) VALUES (
            #{postId}, #{userKey}, #{reason}, #{content}, NOW()
        )
    </insert>

    <!-- 게시글별 신고 조회 -->
    <select id="getReportsByPostId" resultMap="PostReportResultMap">
        SELECT id, post_id, user_key, reason, content, report_time
        FROM hottalk_report 
        WHERE post_id = #{postId}
        ORDER BY report_time DESC
    </select>

    <!-- 사용자별 신고 조회 -->
    <select id="getReportsByUserKey" resultMap="PostReportResultMap">
        SELECT id, post_id, user_key, reason, content, report_time
        FROM hottalk_report 
        WHERE user_key = #{userKey}
        ORDER BY report_time DESC
    </select>

    <!-- 전체 신고 조회 -->
    <select id="getAllReports" resultMap="PostReportResultMap">
        SELECT id, post_id, user_key, reason, content, report_time
        FROM hottalk_report 
        ORDER BY report_time DESC
    </select>

</mapper>
